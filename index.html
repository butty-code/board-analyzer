<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Irish Maths Learning Tool - Interactive Practice</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', system-ui, -apple-system, sans-serif; }
        
        .gradient-text {
            background: linear-gradient(135deg, #169B62 0%, #FF883E 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in { animation: fadeIn 0.5s ease-out; }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
        }
        
        .hover-lift {
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .hover-lift:hover {
            transform: translateY(-3px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.12);
        }

        .math-pattern {
            background-image: 
                linear-gradient(30deg, rgba(22, 155, 98, 0.05) 12%, transparent 12.5%, transparent 87%, rgba(22, 155, 98, 0.05) 87.5%),
                linear-gradient(150deg, rgba(22, 155, 98, 0.05) 12%, transparent 12.5%, transparent 87%, rgba(22, 155, 98, 0.05) 87.5%);
            background-size: 80px 140px;
        }
        
        .pulse-success {
            animation: pulse 0.5s ease-in-out;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #f0f;
            animation: confetti-fall 3s linear;
        }
        
        @keyframes confetti-fall {
            to { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-green-50 via-blue-50 to-orange-50 math-pattern">
    <div id="root"></div>
    
    <script>
        class MathApp {
            constructor() {
                this.state = {
                    level: 'junior',
                    category: 'all',
                    currentCard: null,
                    isFlipped: false,
                    showHint: false,
                    userAnswer: '',
                    result: null,
                    score: 0,
                    total: 0,
                    correct: 0,
                    apiKey: localStorage.getItem('claudeApiKey') || '',
                    showApiSetup: false,
                    aiExplanation: '',
                    aiLoading: false,
                    explanationLevel: 'simple'
                };
                
                this.questionBank = this.initQuestionBank();
                this.generateCard();
                this.render();
            }
            
            initQuestionBank() {
                return {
                    junior: {
                        algebra: [
                            () => {
                                const a = Math.floor(Math.random() * 5) + 2;
                                const b = Math.floor(Math.random() * 10) + 5;
                                const result = Math.floor(Math.random() * 15) + 10;
                                const x = (result - b) / a;
                                return {
                                    question: `Solve for x: ${a}x + ${b} = ${result}`,
                                    hint: `Start by subtracting ${b} from both sides, then divide by ${a}`,
                                    steps: [
                                        `Step 1: Subtract ${b} from both sides`,
                                        `${a}x + ${b} - ${b} = ${result} - ${b}`,
                                        `${a}x = ${result - b}`,
                                        `Step 2: Divide both sides by ${a}`,
                                        `${a}x ÷ ${a} = ${result - b} ÷ ${a}`,
                                        `✅ x = ${(result - b) / a}`
                                    ],
                                    answer: String(x),
                                    category: 'Algebra',
                                    icon: '📐'
                                };
                            },
                            () => {
                                const a = Math.floor(Math.random() * 4) + 2;
                                const b = Math.floor(Math.random() * 8) + 2;
                                return {
                                    question: `Expand: ${a}(x + ${b})`,
                                    hint: `Multiply everything inside the brackets by ${a}`,
                                    steps: [
                                        `Step 1: Multiply ${a} by x`,
                                        `${a} × x = ${a}x`,
                                        `Step 2: Multiply ${a} by ${b}`,
                                        `${a} × ${b} = ${a * b}`,
                                        `Step 3: Combine the results`,
                                        `✅ Answer: ${a}x + ${a * b}`
                                    ],
                                    answer: `${a}x+${a * b}`,
                                    category: 'Algebra',
                                    icon: '📐'
                                };
                            },
                            () => {
                                const factors = [[2,3], [2,4], [2,5], [3,4], [3,5], [2,6]];
                                const [p, q] = factors[Math.floor(Math.random() * factors.length)];
                                const sum = p + q;
                                const product = p * q;
                                return {
                                    question: `Factorise: x² + ${sum}x + ${product}`,
                                    hint: `Find two numbers that multiply to ${product} and add to ${sum}`,
                                    steps: [
                                        `Step 1: Find factors of ${product} that add to ${sum}`,
                                        `Factors: ${p} and ${q}`,
                                        `Check: ${p} × ${q} = ${product} ✓`,
                                        `Check: ${p} + ${q} = ${sum} ✓`,
                                        `Step 2: Write as two brackets`,
                                        `✅ (x + ${p})(x + ${q})`
                                    ],
                                    answer: `(x+${p})(x+${q})`,
                                    category: 'Algebra',
                                    icon: '📐'
                                };
                            }
                        ],
                        geometry: [
                            () => {
                                const base = Math.floor(Math.random() * 10) + 4;
                                const height = Math.floor(Math.random() * 8) + 3;
                                const area = (base * height) / 2;
                                return {
                                    question: `Find the area of a triangle with base ${base}cm and height ${height}cm`,
                                    hint: `Remember: Area of triangle = ½ × base × height`,
                                    steps: [
                                        `Step 1: Write the formula`,
                                        `Area = ½ × base × height`,
                                        `Step 2: Substitute the values`,
                                        `Area = ½ × ${base} × ${height}`,
                                        `Step 3: Calculate`,
                                        `Area = ½ × ${base * height}`,
                                        `✅ Area = ${area} cm²`
                                    ],
                                    answer: String(area),
                                    category: 'Geometry',
                                    icon: '📊',
                                    visual: this.drawTriangle(base, height)
                                };
                            },
                            () => {
                                const radius = Math.floor(Math.random() * 8) + 3;
                                const circ = (2 * 3.14 * radius).toFixed(2);
                                return {
                                    question: `Calculate the circumference of a circle with radius ${radius}cm (use π = 3.14)`,
                                    hint: `Circumference = 2πr, where r is the radius`,
                                    steps: [
                                        `Step 1: Write the formula`,
                                        `C = 2πr`,
                                        `Step 2: Substitute values`,
                                        `C = 2 × 3.14 × ${radius}`,
                                        `Step 3: Calculate`,
                                        `C = 6.28 × ${radius}`,
                                        `✅ C = ${circ} cm`
                                    ],
                                    answer: circ,
                                    category: 'Geometry',
                                    icon: '📊',
                                    visual: this.drawCircle(radius)
                                };
                            },
                            () => {
                                const length = Math.floor(Math.random() * 8) + 4;
                                const width = Math.floor(Math.random() * 6) + 3;
                                const area = length * width;
                                return {
                                    question: `Find the area of a rectangle: length ${length}cm, width ${width}cm`,
                                    hint: `Area of rectangle = length × width`,
                                    steps: [
                                        `Step 1: Write the formula`,
                                        `Area = length × width`,
                                        `Step 2: Substitute values`,
                                        `Area = ${length} × ${width}`,
                                        `✅ Area = ${area} cm²`
                                    ],
                                    answer: String(area),
                                    category: 'Geometry',
                                    icon: '📊'
                                };
                            }
                        ],
                        trigonometry: [
                            () => {
                                const pairs = [[3,5], [5,13], [8,10], [6,10], [12,13]];
                                const [opp, hyp] = pairs[Math.floor(Math.random() * pairs.length)];
                                const sin = (opp / hyp).toFixed(2);
                                return {
                                    question: `Right triangle: opposite = ${opp}cm, hypotenuse = ${hyp}cm. Find sin θ`,
                                    hint: `sin θ = opposite ÷ hypotenuse`,
                                    steps: [
                                        `Step 1: Identify the sides`,
                                        `Opposite = ${opp} cm`,
                                        `Hypotenuse = ${hyp} cm`,
                                        `Step 2: Apply the formula`,
                                        `sin θ = opposite ÷ hypotenuse`,
                                        `Step 3: Calculate`,
                                        `sin θ = ${opp} ÷ ${hyp}`,
                                        `✅ sin θ = ${sin}`
                                    ],
                                    answer: sin,
                                    category: 'Trigonometry',
                                    icon: '📐'
                                };
                            }
                        ]
                    },
                    leaving: {
                        algebra: [
                            () => {
                                const roots = [[2,3], [1,4], [2,5], [3,4], [1,6]];
                                const [r1, r2] = roots[Math.floor(Math.random() * roots.length)];
                                const b = -(r1 + r2);
                                const c = r1 * r2;
                                return {
                                    question: `Solve the quadratic: x² ${b >= 0 ? '+' : ''}${b}x ${c >= 0 ? '+' : ''}${c} = 0`,
                                    hint: `Try factorising first - find factors of ${c} that add to ${b}`,
                                    steps: [
                                        `Step 1: Find factors of ${c} that add to ${b}`,
                                        `Factors: ${-r1} and ${-r2}`,
                                        `Step 2: Write as factors`,
                                        `(x - ${r1})(x - ${r2}) = 0`,
                                        `Step 3: Solve each factor`,
                                        `x - ${r1} = 0  →  x = ${r1}`,
                                        `x - ${r2} = 0  →  x = ${r2}`,
                                        `✅ x = ${r1} or x = ${r2}`
                                    ],
                                    answer: `${r1},${r2}`,
                                    category: 'Algebra',
                                    icon: '📐'
                                };
                            },
                            () => {
                                const a = Math.floor(Math.random() * 3) + 2;
                                const b = Math.floor(Math.random() * 3) + 2;
                                const p1 = Math.floor(Math.random() * 3) + 2;
                                const p2 = Math.floor(Math.random() * 3) + 1;
                                const p3 = Math.floor(Math.random() * 3) + 1;
                                const p4 = Math.floor(Math.random() * 3) + 1;
                                return {
                                    question: `Simplify: (${a}x^${p1}y^${p2}) × (${b}x^${p3}y^${p4})`,
                                    hint: `Multiply coefficients and add the powers of like bases`,
                                    steps: [
                                        `Step 1: Multiply coefficients`,
                                        `${a} × ${b} = ${a * b}`,
                                        `Step 2: Add powers of x`,
                                        `x^${p1} × x^${p3} = x^${p1 + p3}`,
                                        `Step 3: Add powers of y`,
                                        `y^${p2} × y^${p4} = y^${p2 + p4}`,
                                        `✅ ${a * b}x^${p1 + p3}y^${p2 + p4}`
                                    ],
                                    answer: `${a * b}x^${p1 + p3}y^${p2 + p4}`,
                                    category: 'Algebra',
                                    icon: '📐'
                                };
                            }
                        ],
                        geometry: [
                            () => {
                                const radius = Math.floor(Math.random() * 5) + 3;
                                const height = Math.floor(Math.random() * 8) + 6;
                                const volume = (3.14 * radius * radius * height).toFixed(1);
                                return {
                                    question: `Volume of cylinder: radius ${radius}cm, height ${height}cm (π = 3.14)`,
                                    hint: `Volume = πr²h`,
                                    steps: [
                                        `Step 1: Write the formula`,
                                        `V = πr²h`,
                                        `Step 2: Substitute values`,
                                        `V = 3.14 × ${radius}² × ${height}`,
                                        `Step 3: Calculate r²`,
                                        `V = 3.14 × ${radius * radius} × ${height}`,
                                        `Step 4: Final calculation`,
                                        `✅ V = ${volume} cm³`
                                    ],
                                    answer: volume,
                                    category: 'Geometry',
                                    icon: '📊'
                                };
                            },
                            () => {
                                const side = Math.floor(Math.random() * 6) + 4;
                                const area = side * side;
                                return {
                                    question: `Area of a square with side ${side}cm`,
                                    hint: `Area = side²`,
                                    steps: [
                                        `Step 1: Write the formula`,
                                        `Area = side²`,
                                        `Step 2: Substitute`,
                                        `Area = ${side}²`,
                                        `✅ Area = ${area} cm²`
                                    ],
                                    answer: String(area),
                                    category: 'Geometry',
                                    icon: '📊'
                                };
                            }
                        ],
                        trigonometry: [
                            () => {
                                const sinValues = [0.3, 0.4, 0.5, 0.6, 0.7, 0.8];
                                const sinTheta = sinValues[Math.floor(Math.random() * sinValues.length)];
                                const cosTheta = Math.sqrt(1 - sinTheta * sinTheta).toFixed(2);
                                return {
                                    question: `If sin θ = ${sinTheta} and θ is acute, find cos θ`,
                                    hint: `Use the Pythagorean identity: sin²θ + cos²θ = 1`,
                                    steps: [
                                        `Step 1: Write the identity`,
                                        `sin²θ + cos²θ = 1`,
                                        `Step 2: Substitute sin θ = ${sinTheta}`,
                                        `(${sinTheta})² + cos²θ = 1`,
                                        `${(sinTheta * sinTheta).toFixed(2)} + cos²θ = 1`,
                                        `Step 3: Solve for cos²θ`,
                                        `cos²θ = 1 - ${(sinTheta * sinTheta).toFixed(2)}`,
                                        `cos²θ = ${(1 - sinTheta * sinTheta).toFixed(2)}`,
                                        `Step 4: Take the square root`,
                                        `✅ cos θ = ${cosTheta} (positive as θ is acute)`
                                    ],
                                    answer: cosTheta,
                                    category: 'Trigonometry',
                                    icon: '📐'
                                };
                            }
                        ]
                    }
                };
            }
            
            drawTriangle(base, height) {
                return `<div class="my-6"><svg width="200" height="150" viewBox="0 0 200 150" class="mx-auto drop-shadow-lg">
                    <defs>
                        <linearGradient id="triGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#169B62;stop-opacity:0.4" />
                            <stop offset="100%" style="stop-color:#FF883E;stop-opacity:0.4" />
                        </linearGradient>
                    </defs>
                    <polygon points="30,120 170,120 100,30" fill="url(#triGrad)" stroke="#169B62" stroke-width="3"/>
                    <text x="100" y="138" text-anchor="middle" font-size="16" font-weight="bold" fill="#169B62">${base}cm</text>
                    <text x="12" y="75" font-size="16" font-weight="bold" fill="#FF883E">${height}cm</text>
                    <line x1="100" y1="30" x2="100" y2="120" stroke="#FF883E" stroke-width="2" stroke-dasharray="5,5"/>
                </svg></div>`;
            }
            
            drawCircle(radius) {
                return `<div class="my-6"><svg width="200" height="200" viewBox="0 0 200 200" class="mx-auto drop-shadow-lg">
                    <defs>
                        <linearGradient id="circGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#169B62;stop-opacity:0.4" />
                            <stop offset="100%" style="stop-color:#FF883E;stop-opacity:0.4" />
                        </linearGradient>
                    </defs>
                    <circle cx="100" cy="100" r="70" fill="url(#circGrad)" stroke="#169B62" stroke-width="3"/>
                    <line x1="100" y1="100" x2="170" y2="100" stroke="#FF883E" stroke-width="3"/>
                    <text x="135" y="95" font-size="16" font-weight="bold" fill="#FF883E">${radius}cm</text>
                    <circle cx="100" cy="100" r="5" fill="#169B62"/>
                </svg></div>`;
            }
            
            generateCard() {
                const categories = this.state.category === 'all' 
                    ? Object.keys(this.questionBank[this.state.level])
                    : [this.state.category];
                
                const randomCat = categories[Math.floor(Math.random() * categories.length)];
                const questions = this.questionBank[this.state.level][randomCat];
                const randomQ = questions[Math.floor(Math.random() * questions.length)];
                
                this.state.currentCard = randomQ();
                this.state.isFlipped = false;
                this.state.showHint = false;
                this.state.userAnswer = '';
                this.state.result = null;
                this.state.aiExplanation = '';
                this.render();
            }
            
            checkAnswer() {
                const user = this.state.userAnswer.trim().toLowerCase().replace(/\s/g, '').replace(/\^/g, '').replace(/\*\*/g, '');
                const correct = this.state.currentCard.answer.toLowerCase().replace(/\s/g, '').replace(/\^/g, '').replace(/\*\*/g, '');
                
                const userParts = user.split(',').sort();
                const correctParts = correct.split(',').sort();
                
                const isCorrect = JSON.stringify(userParts) === JSON.stringify(correctParts) ||
                                Math.abs(parseFloat(user) - parseFloat(correct)) < 0.11;
                
                this.state.result = isCorrect;
                this.state.total++;
                if (isCorrect) {
                    this.state.correct++;
                    this.state.score++;
                    this.showConfetti();
                }
                this.render();
            }
            
            showConfetti() {
                const colors = ['#169B62', '#FF883E', '#3B82F6', '#8B5CF6', '#EC4899'];
                for(let i = 0; i < 50; i++) {
                    setTimeout(() => {
                        const confetti = document.createElement('div');
                        confetti.className = 'confetti';
                        confetti.style.left = Math.random() * 100 + '%';
                        confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                        confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                        document.body.appendChild(confetti);
                        setTimeout(() => confetti.remove(), 3000);
                    }, i * 30);
                }
            }
            
            async getAiExplanation() {
                if (!this.state.apiKey) {
                    alert('⚠️ Please set up your Claude API key first! Click the "🤖 AI Tutor Setup" button.');
                    return;
                }

                this.state.aiLoading = true;
                this.render();

                try {
                    const prompts = {
                        simple: "Explain this like I'm 5 years old, using simple words and fun examples",
                        detailed: "Explain this step-by-step with clear reasoning at each stage",
                        visual: "Explain this using analogies, real-world examples, and visual thinking"
                    };

                    const response = await fetch("https://api.anthropic.com/v1/messages", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "x-api-key": this.state.apiKey,
                            "anthropic-version": "2023-06-01"
                        },
                        body: JSON.stringify({
                            model: "claude-sonnet-4-20250514",
                            max_tokens: 1024,
                            messages: [{
                                role: "user",
                                content: `I'm a secondary school student in Ireland struggling with this math problem:

Question: ${this.state.currentCard.question}

Solution steps:
${this.state.currentCard.steps.join('\n')}

${prompts[this.state.explanationLevel]}. Help me understand WHY each step works and what the logic is behind it. Make it relatable to everyday life if possible.`
                            }]
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`API Error: ${response.status}`);
                    }

                    const data = await response.json();
                    this.state.aiExplanation = data.content[0].text;
                } catch (error) {
                    this.state.aiExplanation = `❌ Error: ${error.message}\n\nPlease check:\n1. Your API key is valid\n2. You have credits in your Claude account\n3. Your internet connection is working`;
                }

                this.state.aiLoading = false;
                this.render();
            }
            
            saveApiKey() {
                if (this.state.apiKey) {
                    localStorage.setItem('claudeApiKey', this.state.apiKey);
                    alert('✅ API Key saved! You can now use the AI Tutor feature.');
                    this.state.showApiSetup = false;
                    this.render();
                } else {
                    alert('⚠️ Please enter an API key first');
                }
            }
            
            render() {
                const root = document.getElementById('root');
                const card = this.state.currentCard;
                const percentage = this.state.total > 0 ? Math.round((this.state.correct / this.state.total) * 100) : 0;
                
                root.innerHTML = `
                    <div class="min-h-screen p-4 pb-12">
                        <div class="max-w-5xl mx-auto fade-in">
                            <!-- Header -->
                            <div class="text-center mb-8">
                                <div class="inline-block mb-4">
                                    <h1 class="text-5xl md:text-6xl font-black gradient-text mb-2">Irish Maths Tool</h1>
                                    <div class="h-1.5 w-full bg-gradient-to-r from-green-600 to-orange-500 rounded-full"></div>
                                </div>
                                <p class="text-xl md:text-2xl text-gray-700 font-semibold mb-4">🎲 Infinite Randomly Generated Questions</p>
                                <button onclick="app.state.showApiSetup = !app.state.showApiSetup; app.render();" 
                                        class="px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-xl font-bold hover-lift shadow-xl text-lg">
                                    🤖 AI Tutor Setup ${this.state.apiKey ? '✅' : ''}
                                </button>
                            </div>

                            <!-- API Setup Modal -->
                            ${this.state.showApiSetup ? `
                                <div class="glass-effect rounded-2xl shadow-2xl p-6 md:p-8 mb-8 border-2 border-purple-400 fade-in">
                                    <h3 class="text-2xl md:text-3xl font-bold text-purple-700 mb-6 flex items-center gap-3">
                                        <span class="text-4xl">🤖</span> AI Tutor Setup
                                    </h3>
                                    
                                    <div class="bg-gradient-to-r from-blue-100 to-indigo-100 border-l-4 border-blue-600 p-5 rounded-lg mb-6 shadow-md">
                                        <p class="text-lg font-bold text-blue-900 mb-2">💡 What is this?</p>
                                        <p class="text-blue-800 leading-relaxed">
                                            The AI Tutor uses Claude AI to explain solutions in different ways when you're stuck! 
                                            It's like having a personal maths teacher available 24/7.
                                        </p>
                                    </div>

                                    <div class="space-y-6">
                                        <div class="bg-white rounded-xl p-6 shadow-lg border-2 border-gray-200">
                                            <h4 class="font-bold text-xl mb-4 text-gray-800">📋 How to get your API Key:</h4>
                                            <ol class="space-y-3 ml-6 list-decimal text-gray-700 text-base">
                                                <li class="leading-relaxed">Go to <a href="https://console.anthropic.com/" target="_blank" rel="noopener noreferrer" 
                                                    class="text-blue-600 underline font-bold hover:text-blue-800">console.anthropic.com</a></li>
                                                <li class="leading-relaxed">Sign up or log in (use your email)</li>
                                                <li class="leading-relaxed">Click "Get API Keys" in the dashboard</li>
                                                <li class="leading-relaxed">Create a new key and copy it</li>
                                                <li class="leading-relaxed">Paste it below</li>
                                            </ol>
                                        </div>

                                        <div class="bg-gradient-to-r from-yellow-100 to-orange-100 border-l-4 border-yellow-500 p-5 rounded-lg shadow-md">
                                            <p class="text-base text-yellow-900 leading-relaxed">
                                                💰 <strong>Pricing:</strong> Claude offers $5 free credits when you sign up! That's enough for hundreds of explanations. 
                                                After that, it's pay-as-you-go (very cheap - about €0.003 per explanation).
                                            </p>
                                        </div>

                                        <div>
                                            <label class="block text-lg font-bold text-gray-800 mb-3">
                                                Your Claude API Key:
                                            </label>
                                            <input
                                                type="password"
                                                value="${this.state.apiKey}"
                                                oninput="app.state.apiKey = this.value"
                                                placeholder="sk-ant-..."
                                                class="w-full p-4 border-3 border-purple-300 rounded-xl text-lg focus:border-purple-600 focus:outline-none focus:ring-4 focus:ring-purple-200 transition shadow-md"
                                            />
                                            <p class="text-sm text-gray-600 mt-2 flex items-start gap-2">
                                                🔒 <span>Your API key is stored only in your browser and never sent anywhere except Claude's servers</span>
                                            </p>
                                        </div>

                                        <div class="flex gap-3">
                                            <button
                                                onclick="app.saveApiKey()"
                                                class="flex-1 py-3 bg-gradient-to-r from-purple-600 to-purple-700 text-white rounded-xl hover:from-purple-700 hover:to-purple-800 transition font-bold text-lg shadow-lg hover-lift"
                                            >
                                                💾 Save Key
                                            </button>
                                            <button
                                                onclick="app.state.showApiSetup = false; app.render()"
                                                class="px-8 py-3 bg-gray-300 hover:bg-gray-400 text-gray-800 rounded-xl transition font-bold text-lg shadow-lg"
                                            >
                                                Close
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            ` : ''}

                            <!-- Controls -->
                            <div class="glass-effect rounded-2xl shadow-xl p-6 mb-8 border-2 border-white">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-base font-bold text-gray-800 mb-3">📚 Level</label>
                                        <select 
                                            onchange="app.state.level = this.value; app.generateCard()" 
                                            class="w-full p-3 border-2 border-gray-300 rounded-xl text-lg font-semibold focus:border-green-600 focus:outline-none focus:ring-4 focus:ring-green-200 transition shadow-md hover-lift"
                                        >
                                            <option value="junior" ${this.state.level === 'junior' ? 'selected' : ''}>Junior Cycle (Ages 13-15)</option>
                                            <option value="leaving" ${this.state.level === 'leaving' ? 'selected' : ''}>Leaving Cert (Ages 16-18)</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-base font-bold text-gray-800 mb-3">🎯 Topic</label>
                                        <select 
                                            onchange="app.state.category = this.value; app.generateCard()" 
                                            class="w-full p-3 border-2 border-gray-300 rounded-xl text-lg font-semibold focus:border-blue-600 focus:outline-none focus:ring-4 focus:ring-blue-200 transition shadow-md hover-lift"
                                        >
                                            <option value="all" ${this.state.category === 'all' ? 'selected' : ''}>🎲 Random Mix</option>
                                            <option value="algebra" ${this.state.category === 'algebra' ? 'selected' : ''}>📐 Algebra</option>
                                            <option value="geometry" ${this.state.category === 'geometry' ? 'selected' : ''}>📊 Geometry</option>
                                            <option value="trigonometry" ${this.state.category === 'trigonometry' ? 'selected' : ''}>📐 Trigonometry</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-base font-bold text-gray-800 mb-3">🔄 New Question</label>
                                        <button
                                            onclick="app.generateCard()"
                                            class="w-full p-3 bg-gradient-to-r from-green-600 to-blue-600 text-white rounded-xl font-bold text-lg hover:from-green-700 hover:to-blue-700 transition shadow-lg hover-lift"
                                        >
                                            🎲 Shuffle New
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Score Display -->
                            ${this.state.total > 0 ? `
                                <div class="glass-effect rounded-2xl p-6 mb-8 border-l-8 ${percentage >= 80 ? 'border-green-600' : percentage >= 50 ? 'border-yellow-600' : 'border-orange-600'} shadow-xl hover-lift">
                                    <div class="flex items-center justify-between flex-wrap gap-4">
                                        <div class="flex items-center gap-4">
                                            <span class="text-5xl">${percentage >= 80 ? '🏆' : percentage >= 50 ? '⭐' : '💪'}</span>
                                            <div>
                                                <p class="text-2xl font-black text-gray-800">Session Score</p>
                                                <p class="text-lg text-gray-600 font-semibold">${this.state.correct} correct out of ${this.state.total} attempts</p>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <p class="text-6xl font-black ${percentage >= 80 ? 'text-green-600' : percentage >= 50 ? 'text-yellow-600' : 'text-orange-600'}">${percentage}%</p>
                                            <p class="text-sm font-semibold text-gray-600 mt-1">
                                                ${percentage >= 80 ? 'Excellent!' : percentage >= 50 ? 'Good Job!' : 'Keep Practicing!'}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            ` : ''}

                            <!-- Flashcard -->
                            ${card ? `
                                <div class="glass-effect rounded-3xl shadow-2xl p-8 mb-8 border-2 border-white hover-lift ${this.state.result === true ? 'pulse-success' : ''}">
                                    <div class="flex justify-between items-center mb-6 flex-wrap gap-4">
                                        <span class="px-5 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-full text-base font-bold shadow-lg flex items-center gap-2">
                                            ${card.icon} ${card.category}
                                        </span>
                                        <button
                                            onclick="app.state.isFlipped = !app.state.isFlipped; app.render()"
                                            class="flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-xl hover:from-green-700 hover:to-green-800 transition font-bold text-lg shadow-lg"
                                        >
                                            ${this.state.isFlipped ? '❓ Show Question' : '✅ Show Solution'}
                                        </button>
                                    </div>

                                    ${!this.state.isFlipped ? `
                                        <div class="min-h-64">
                                            <h2 class="text-2xl md:text-3xl font-bold text-gray-900 mb-6 leading-relaxed">${card.question}</h2>

                                            ${card.visual || ''}

                                            ${this.state.result === null ? `
                                                <div class="mt-6">
                                                    <label class="block text-lg font-bold text-gray-800 mb-3">
                                                        ✏️ Your Answer:
                                                    </label>
                                                    <input
                                                        type="text"
                                                        value="${this.state.userAnswer}"
                                                        oninput="app.state.userAnswer = this.value"
                                                        onkeypress="if(event.key==='Enter') app.checkAnswer()"
                                                        placeholder="Enter your answer..."
                                                        class="w-full p-4 border-3 border-gray-300 rounded-xl text-xl focus:border-blue-600 focus:outline-none focus:ring-4 focus:ring-blue-200 transition shadow-md mb-4"
                                                    />
                                                    <button
                                                        onclick="app.checkAnswer()"
                                                        class="w-full py-4 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-xl hover:from-blue-700 hover:to-blue-800 transition font-bold text-xl shadow-lg hover-lift"
                                                    >
                                                        ✓ Check Answer
                                                    </button>
                                                </div>
                                            ` : `
                                                <div class="mt-6 p-6 rounded-2xl flex items-center gap-4 shadow-lg ${
                                                    this.state.result 
                                                        ? 'bg-gradient-to-r from-green-100 to-green-200 border-4 border-green-500' 
                                                        : 'bg-gradient-to-r from-red-100 to-red-200 border-4 border-red-500'
                                                }">
                                                    <span class="text-5xl">${this.state.result ? '🎉' : '❌'}</span>
                                                    <div class="flex-1">
                                                        <span class="font-bold text-xl block ${this.state.result ? 'text-green-900' : 'text-red-900'}">
                                                            ${this.state.result 
                                                                ? '🎉 Correct! Brilliant work!' 
                                                                : `Not quite. The correct answer is: ${card.answer}`}
                                                        </span>
                                                    </div>
                                                    <button
                                                        onclick="app.generateCard()"
                                                        class="px-6 py-3 bg-white rounded-xl hover:bg-gray-100 transition font-bold text-lg shadow-md hover-lift"
                                                    >
                                                        Next Question →
                                                    </button>
                                                </div>
                                            `}

                                            <button
                                                onclick="app.state.showHint = !app.state.showHint; app.render()"
                                                class="mt-6 flex items-center gap-3 px-6 py-3 bg-gradient-to-r from-yellow-400 to-yellow-500 text-yellow-900 rounded-xl hover:from-yellow-500 hover:to-yellow-600 transition font-bold text-lg shadow-lg hover-lift"
                                            >
                                                💡 ${this.state.showHint ? 'Hide Hint' : 'Need a Hint?'}
                                            </button>

                                            ${this.state.showHint ? `
                                                <div class="mt-4 p-5 bg-gradient-to-r from-yellow-100 to-yellow-200 border-l-8 border-yellow-500 rounded-xl shadow-lg">
                                                    <p class="text-lg text-gray-900 font-semibold leading-relaxed">${card.hint}</p>
                                                </div>
                                            ` : ''}

                                            <!-- AI Tutor Section -->
                                            <div class="mt-8 pt-6 border-t-4 border-gray-200">
                                                <div class="bg-gradient-to-r from-purple-100 to-pink-100 rounded-2xl p-6 shadow-lg border-2 border-purple-300">
                                                    <div class="flex items-center justify-between mb-4 flex-wrap gap-3">
                                                        <div>
                                                            <h4 class="font-bold text-xl text-purple-900 flex items-center gap-2">
                                                                🤖 Still Confused?
                                                            </h4>
                                                            <p class="text-base text-purple-700 font-semibold">Ask AI to explain it differently!</p>
                                                        </div>
                                                        ${!this.state.apiKey ? `
                                                            <button
                                                                onclick="app.state.showApiSetup = true; app.render()"
                                                                class="px-4 py-2 bg-purple-300 hover:bg-purple-400 text-purple-900 rounded-lg font-bold text-sm transition shadow-md"
                                                            >
                                                                Setup AI
                                                            </button>
                                                        ` : ''}
                                                    </div>
                                                    
                                                    ${this.state.apiKey ? `
                                                        <div class="space-y-4">
                                                            <div>
                                                                <label class="block text-base font-bold text-gray-800 mb-3">
                                                                    Choose Explanation Style:
                                                                </label>
                                                                <div class="grid grid-cols-3 gap-3">
                                                                    <button
                                                                        onclick="app.state.explanationLevel = 'simple'; app.render()"
                                                                        class="py-3 px-4 rounded-xl text-base font-bold transition shadow-md hover-lift ${
                                                                            this.state.explanationLevel === 'simple'
                                                                                ? 'bg-gradient-to-r from-purple-600 to-purple-700 text-white'
                                                                                : 'bg-white text-gray-800 hover:bg-gray-100'
                                                                        }"
                                                                    >
                                                                        👶 Like I'm 5
                                                                    </button>
                                                                    <button
                                                                        onclick="app.state.explanationLevel = 'detailed'; app.render()"
                                                                        class="py-3 px-4 rounded-xl text-base font-bold transition shadow-md hover-lift ${
                                                                            this.state.explanationLevel === 'detailed'
                                                                                ? 'bg-gradient-to-r from-purple-600 to-purple-700 text-white'
                                                                                : 'bg-white text-gray-800 hover:bg-gray-100'
                                                                        }"
                                                                    >
                                                                        📚 Detailed
                                                                    </button>
                                                                    <button
                                                                        onclick="app.state.explanationLevel = 'visual'; app.render()"
                                                                        class="py-3 px-4 rounded-xl text-base font-bold transition shadow-md hover-lift ${
                                                                            this.state.explanationLevel === 'visual'
                                                                                ? 'bg-gradient-to-r from-purple-600 to-purple-700 text-white'
                                                                                : 'bg-white text-gray-800 hover:bg-gray-100'
                                                                        }"
                                                                    >
                                                                        🎨 Visual
                                                                    </button>
                                                                </div>
                                                            </div>
                                                            
                                                            <button
                                                                onclick="app.getAiExplanation()"
                                                                ${this.state.aiLoading ? 'disabled' : ''}
                                                                class="w-full py-4 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-xl hover:from-purple-700 hover:to-pink-700 transition font-bold text-xl shadow-lg disabled:opacity-50 disabled:cursor-not-allowed hover-lift"
                                                            >
                                                                ${this.state.aiLoading ? '🤔 AI is thinking...' : '✨ Get AI Explanation'}
                                                            </button>
                                                        </div>
                                                    ` : ''}

                                                    ${this.state.aiExplanation ? `
                                                        <div class="mt-6 p-6 bg-white rounded-2xl border-4 border-purple-400 shadow-xl">
                                                            <div class="flex items-start gap-3 mb-4">
                                                                <span class="text-4xl">🤖</span>
                                                                <h4 class="font-black text-xl text-purple-900">AI Tutor Explanation:</h4>
                                                            </div>
                                                            <div class="text-gray-900 whitespace-pre-wrap text-base leading-relaxed font-medium">
                                                                ${this.state.aiExplanation}
                                                            </div>
                                                            <div class="mt-4 pt-4 border-t-2 border-purple-200">
                                                                <p class="text-sm text-purple-700 font-semibold">
                                                                    💡 Try different explanation styles above to find what works best for you!
                                                                </p>
                                                            </div>
                                                        </div>
                                                    ` : ''}
                                                </div>
                                            </div>
                                        </div>
                                    ` : `
                                        <div class="min-h-64">
                                            <h3 class="text-2xl font-black text-green-700 mb-6 flex items-center gap-3">
                                                <span class="text-3xl">✅</span> Step-by-Step Solution:
                                            </h3>
                                            <div class="space-y-4">
                                                ${card.steps.map((step, idx) => `
                                                    <div class="p-5 bg-gradient-to-r from-gray-50 to-gray-100 rounded-xl border-l-8 border-green-600 shadow-md hover-lift">
                                                        <p class="text-lg text-gray-900 font-semibold leading-relaxed">${step}</p>
                                                    </div>
                                                `).join('')}
                                            </div>
                                            <div class="mt-8 p-6 bg-gradient-to-r from-green-100 to-green-200 border-l-8 border-green-600 rounded-2xl shadow-xl">
                                                <p class="font-black text-2xl text-green-900">✅ Final Answer: ${card.answer}</p>
                                            </div>
                                            <button
                                                onclick="app.generateCard()"
                                                class="mt-6 w-full py-4 bg-gradient-to-r from-green-600 to-blue-600 text-white rounded-xl hover:from-green-700 hover:to-blue-700 transition font-bold text-xl shadow-lg hover-lift"
                                            >
                                                🎲 Generate New Question
                                            </button>
                                        </div>
                                    `}
                                </div>
                            ` : ''}

                            <!-- Footer -->
                            <div class="text-center glass-effect rounded-2xl p-6 shadow-lg border-2 border-white">
                                <p class="text-xl font-black text-gray-800 mb-2">🎲 Infinite Practice Questions!</p>
                                <p class="text-base text-gray-700 font-semibold mb-2">Every question is randomly generated with different numbers</p>
                                <p class="text-base text-gray-600 font-semibold">📚 Aligned with Irish Junior Cycle & Leaving Certificate Curriculum</p>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // Initialize the app
        const app = new MathApp();
    </script>
</body>
</html>
